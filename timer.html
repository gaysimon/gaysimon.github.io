<!doctype html>
<html lang=en>
	<head>
		<meta charset=utf-8>
		<title>timer</title>
		
		<style>
		
			.container {
				margin-bottom: 10px;
				display: flex;
				justify-content: center;
				align-items: center;
				text-align: center;
			}

			.bouton{
				display: inline-block;
				margin-left: auto;
				margin-right: auto;
				border:solid;
				border-color:rgb(142,146,170) rgb(21,23,35) rgb(21,23,35) rgb(142,146,170);
				background-color: rgb(42,46,70);
				color:rgb(232,78,15);
				padding: 15px;
			}
		
		</style>

	</head>
	<body>
		<p id="clock" style="font-size:24px;">heure</p>
		
		<div id="activation" class="container">
			<div class="bouton">
				cliquez ici pour activer le son
			</div>
		</div>
		
		<br/>
		
		<div style="display: flex;justify-content: center; margin-bottom:30px">
			<img src="Logo_speedmeeting.png" style="width:80%;max-width:380px"/>
		</div>
		
		<div id="timer">
			<canvas id="timercanvas"  height="60"></canvas>
		</div>
		
		<div style="display: flex;justify-content: center;font-size:24px">
			<p id="crenau"></p>
		</div>
		

		
		
		<script>
		
			const period=15*60;
			
			// sound's time
			const soundDepartTime=0;
			const soundChangerTime=1*60;
			const soundMoitieTime=7*60;
		
			// get current time
			var now = new Date();
			var heure   = now.getHours();
			var minute  = now.getMinutes();
			var seconde = now.getSeconds();
			var millisec = now.getMilliseconds();
			
			var clicked=0;
			document.addEventListener("click", clickOnPage);
			
			var timerBar   = document.getElementById("timercanvas");
			var timerCanvas = timerBar.getContext("2d");
		
			var time=0;
			var previous=-1;
			
			var delay=0;
			var delayRemain=0;
			var delayMin=0;
			var delaySec=0;
			
			var width=window.innerWidth;
			var width2=width-90;
			
			var message="";
			var horloge="";
		
			timerBar.width  = width;
			
			// load sounds
			var soundDepart = new Audio("depart.mp3");
			soundDepart.loop = false;
			var soundChanger = new Audio("changer.mp3");
			soundChanger.loop = false;
			var soundMoitie = new Audio("moitie.mp3");
			soundMoitie.loop = false;
			
			
			// draw progression bar
			function drawTimer(){
				
				width=window.innerWidth;
				width2=width-90;
				timerBar.width  = width;
				
				// background
				timerCanvas.fillStyle = "rgb(42,46,70)";
				timerCanvas.fillRect(20, 0, width2, 60);
				
				// main bar
				timerCanvas.fillStyle="rgb(232,78,15)";
				timerCanvas.fillRect(20, 0, width2*((delay+1+(millisec/1000))/period), 60);
			}
		
			// detect an interaction in the page
			function clickOnPage(){
				if (clicked==0){
					 document.getElementById("activation").remove();
					 clicked=1;
				}
			}
		
			// manage the interface
			function getTime(){
				
				// get current time
				now = new Date();
				seconde = now.getSeconds();
				millisec = now.getMilliseconds();
				
				
				if (seconde!=previous){	// compute only when seconds change
					previous=seconde;
					
					heure   = now.getHours();
					minute  = now.getMinutes();
					
					time=minute*60+seconde;		// get time in seconds
					
					delay=time%period;			// get time slot progression
					delayRemain=period-delay;	// slot's remaining seconds
				
					delayMin=Math.floor(delayRemain/60);	// time in minutes
					delaySec=delayRemain%60;				// and seconds
				
					// display time
					horloge=""+heure;
					if (minute<10) horloge+=":0"+minute;
					else 		   horloge+=":"+minute;
					if (seconde<10) horloge+=":0"+seconde;
					else 		     horloge+=":"+seconde;
					document.getElementById("clock").innerHTML = "heure : "+horloge;
				
					// play sound when needed
					if (delay>=soundDepartTime  && delay<soundDepartTime+2 ) soundDepart.play();
					if (delay>=soundMoitieTime  && delay<soundMoitieTime+2 ) soundMoitie.play();
					if (delay>=soundChangerTime && delay<soundChangerTime+2) soundChanger.play();
				
					// display remaining time
					message="temps restant : ";
					if (delayRemain>=210) message+=(delayMin+1)+" minutes";
					else if (delayRemain>59) message+=delayMin+" mins "+delaySec+" sec";
					else message+=delaySec+" secondes";
					document.getElementById("crenau").innerHTML = message;
				}
				
				
				drawTimer();				// draw progression bar

				setTimeout(getTime, 200);	// repeat function
			}
			
			
			// start timer's main function
			getTime();
		
			
		
		</script>
		
		
	</body>
</html>
